"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[136],{4318:function(){},3496:function(e,a,t){t.d(a,{A:function(){return v}});var l=t(6768),s=t(4232);const n={id:"themeMask"},i=["cx","cy","r"],o=["r"],d=["opacity"];function r(e,a,t,r,u,c){return(0,l.uX)(),(0,l.CE)("div",{id:"themeToggle",onClick:a[0]||(a[0]=(...e)=>c.handleToggleClick&&c.handleToggleClick(...e))},[((0,l.uX)(),(0,l.CE)("svg",{class:(0,s.C4)(["theme_toggle_svg",{dark:u.isDark}]),width:"1.3em",height:"1.3em",viewBox:"0 0 24 24",fill:"none","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",stroke:"currentColor"},[(0,l.Lk)("mask",n,[a[1]||(a[1]=(0,l.Lk)("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"white"},null,-1)),(0,l.Lk)("circle",{class:"theme_toggle_circle1",fill:"black",cx:u.isDark?"50%":"100%",cy:u.isDark?"23%":"0%",r:u.isDark?"9":"5"},null,8,i)]),(0,l.Lk)("circle",{class:"theme_toggle_circle2",cx:"12",cy:"12",r:u.isDark?"9":"5",mask:"url(#themeMask)"},null,8,o),(0,l.Lk)("g",{class:"theme_toggle_g",stroke:"currentColor",opacity:u.isDark?0:1},a[2]||(a[2]=[(0,l.Fv)('<line x1="12" y1="1" x2="12" y2="3" data-v-4c88bff4></line><line x1="12" y1="21" x2="12" y2="23" data-v-4c88bff4></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64" data-v-4c88bff4></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78" data-v-4c88bff4></line><line x1="1" y1="12" x2="3" y2="12" data-v-4c88bff4></line><line x1="21" y1="12" x2="23" y2="12" data-v-4c88bff4></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36" data-v-4c88bff4></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22" data-v-4c88bff4></line>',8)]),8,d)],2))])}var u={name:"ToggleDark",data(){return{isDark:this.$store.getters.useDarkMode}},methods:{handleToggleClick(){this.isDark=!this.isDark,this.$store.commit("setUseDarkMode",this.isDark),this.$store.commit("setCusDarkMode",!0)}}},c=t(1241);const m=(0,c.A)(u,[["render",r],["__scopeId","data-v-4c88bff4"]]);var h=m,b=t(9017);t(5331),t(6055),t(8830),t(3597);const g={class:"tabs"},p={class:"tabs-dropdown-link"};function f(e,a,t,n,i,o){const d=(0,l.g2)("font-awesome-icon"),r=b.c6,u=b.Iy,c=b.dW,m=h;return(0,l.uX)(),(0,l.CE)("div",g,[(0,l.Lk)("span",{class:"title",onClick:a[0]||(a[0]=(...e)=>o.refreshDashboard&&o.refreshDashboard(...e))},[(0,l.bF)(d,{icon:o.iconName,class:"fa-images"},null,8,["icon"]),(0,l.eW)(" "+(0,s.v_)(o.titleName),1)]),(0,l.bF)(c,{onCommand:o.handleTabClick,class:"tabs-dropdown",role:"navigation",onVisibleChange:o.handleDropdownVisible,"popper-class":"tabs-dropdown-popper"},{dropdown:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>["dashboard"!==t.activeTab?((0,l.uX)(),(0,l.Wv)(r,{key:0,command:"dashboard"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{icon:"images",style:{"margin-right":"5px"}}),a[1]||(a[1]=(0,l.eW)(" Gallery "))])),_:1})):(0,l.Q3)("",!0),"customerConfig"!==t.activeTab?((0,l.uX)(),(0,l.Wv)(r,{key:1,command:"customerConfig"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{icon:"user-cog",style:{"margin-right":"5px"}}),a[2]||(a[2]=(0,l.eW)(" 用户管理 "))])),_:1})):(0,l.Q3)("",!0),"systemConfig"!==t.activeTab?((0,l.uX)(),(0,l.Wv)(r,{key:2,command:"systemConfig"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{icon:"cogs",style:{"margin-right":"5px"}}),a[3]||(a[3]=(0,l.eW)(" 系统设置 "))])),_:1})):(0,l.Q3)("",!0),(0,l.bF)(r,{command:""},{default:(0,l.k6)((()=>[(0,l.bF)(d,{icon:"upload",style:{"margin-right":"5px"}}),a[4]||(a[4]=(0,l.eW)(" 上传页面 "))])),_:1})])),_:1})])),default:(0,l.k6)((()=>[(0,l.Lk)("span",p,[(0,l.bF)(d,{icon:"bars",class:"tabs-arrow"})])])),_:1},8,["onCommand","onVisibleChange"]),(0,l.bF)(m)])}t(4114);var k={name:"DashboardTabs",props:{activeTab:{type:String,default:"dashboard"}},components:{AdminToggleDark:h},computed:{titleName(){return"dashboard"===this.activeTab?"Gallery":"customerConfig"===this.activeTab?"用户管理":"systemConfig"===this.activeTab?"系统设置":"上传页面"},iconName(){return"dashboard"===this.activeTab?"images":"customerConfig"===this.activeTab?"user-cog":"systemConfig"===this.activeTab?"cogs":"upload"}},methods:{refreshDashboard(){location.reload()},handleTabClick(e){this.$router.push(`/${e}`)},handleDropdownVisible(e){const a=document.querySelector(".tabs-dropdown-link");e?a.classList.add("rotate-up"):a.classList.remove("rotate-up")}}};const C=(0,c.A)(k,[["render",f],["__scopeId","data-v-0de0fc64"]]);var v=C},8136:function(e,a,t){t.r(a),t.d(a,{default:function(){return he}});var l=t(9114),s=(t(5331),t(694),t(47)),n=(t(9648),t(2105)),i=(t(9092),t(2006)),o=(t(8642),t(3003),t(5558)),d=(t(456),t(1450)),r=(t(213),t(6768));const u={class:"others-settings"},c={class:"first-settings"},m={class:"second-title"},h={class:"second-title"},b={class:"second-title"},g={class:"actions"};function p(e,a,t,p,f,k){const C=(0,r.g2)("font-awesome-icon"),v=d.R7,y=o.qi,F=i.xE,w=i.US,_=n.WK,V=s.S2,S=l.L;return(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",u,[(0,r.Lk)("div",c,[a[8]||(a[8]=(0,r.Lk)("h3",{class:"first-title"},"其他设置",-1)),(0,r.Lk)("h4",m,[a[5]||(a[5]=(0,r.eW)("远端遥测 ")),(0,r.bF)(v,{content:"便于问题查找和定位，建议开启",placement:"right"},{default:(0,r.k6)((()=>[(0,r.bF)(C,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})])),_:1})]),(0,r.bF)(w,{model:f.settings.telemetry,"label-width":"120px"},{default:(0,r.k6)((()=>[(0,r.bF)(F,{label:"启用"},{default:(0,r.k6)((()=>[(0,r.bF)(y,{modelValue:f.settings.telemetry.enabled,"onUpdate:modelValue":a[0]||(a[0]=e=>f.settings.telemetry.enabled=e),disabled:f.settings.telemetry.fixed},null,8,["modelValue","disabled"])])),_:1})])),_:1},8,["model"]),(0,r.Lk)("h4",h,[a[6]||(a[6]=(0,r.eW)("随机图像API ")),(0,r.bF)(v,{content:"API具体用法请查阅文档",placement:"right"},{default:(0,r.k6)((()=>[(0,r.bF)(C,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})])),_:1})]),(0,r.bF)(w,{model:f.settings.randomImageAPI,"label-width":"120px"},{default:(0,r.k6)((()=>[(0,r.bF)(F,{label:"启用"},{default:(0,r.k6)((()=>[(0,r.bF)(y,{modelValue:f.settings.randomImageAPI.enabled,"onUpdate:modelValue":a[1]||(a[1]=e=>f.settings.randomImageAPI.enabled=e),disabled:f.settings.randomImageAPI.fixed},null,8,["modelValue","disabled"])])),_:1})])),_:1},8,["model"]),(0,r.Lk)("h4",b,[a[7]||(a[7]=(0,r.eW)("CloudFlare API Token ")),(0,r.bF)(v,{content:"设置后可以使后端拉黑、删除等操作不受CDN缓存限制 <br/> 建议设置,设置方式请查阅文档",placement:"right","raw-content":""},{default:(0,r.k6)((()=>[(0,r.bF)(C,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})])),_:1})]),(0,r.bF)(w,{model:f.settings.cloudflareApiToken,"label-width":"120px"},{default:(0,r.k6)((()=>[(0,r.bF)(F,{label:"区域ID"},{default:(0,r.k6)((()=>[(0,r.bF)(_,{modelValue:f.settings.cloudflareApiToken.CF_ZONE_ID,"onUpdate:modelValue":a[2]||(a[2]=e=>f.settings.cloudflareApiToken.CF_ZONE_ID=e),disabled:f.settings.cloudflareApiToken.fixed},null,8,["modelValue","disabled"])])),_:1}),(0,r.bF)(F,{label:"账户邮箱"},{default:(0,r.k6)((()=>[(0,r.bF)(_,{modelValue:f.settings.cloudflareApiToken.CF_EMAIL,"onUpdate:modelValue":a[3]||(a[3]=e=>f.settings.cloudflareApiToken.CF_EMAIL=e),disabled:f.settings.cloudflareApiToken.fixed},null,8,["modelValue","disabled"])])),_:1}),(0,r.bF)(F,{label:"API Key"},{default:(0,r.k6)((()=>[(0,r.bF)(_,{modelValue:f.settings.cloudflareApiToken.CF_API_KEY,"onUpdate:modelValue":a[4]||(a[4]=e=>f.settings.cloudflareApiToken.CF_API_KEY=e),disabled:f.settings.cloudflareApiToken.fixed},null,8,["modelValue","disabled"])])),_:1})])),_:1},8,["model"])]),(0,r.Lk)("div",g,[(0,r.bF)(V,{type:"primary",onClick:k.saveSettings},{default:(0,r.k6)((()=>a[9]||(a[9]=[(0,r.eW)("保存设置")]))),_:1},8,["onClick"])])])),[[S,f.loading]])}t(4114);var f=t(782),k={data(){return{settings:{telemetry:{},randomImageAPI:{},cloudflareApiToken:{}},loading:!1}},computed:{...(0,f.L8)(["credentials"])},methods:{async fetchWithAuth(e,a={}){this.credentials&&(a.headers={...a.headers,Authorization:`Basic ${this.credentials}`},a.credentials="include");const t=await fetch(e,a);if(401===t.status)throw this.$message.error("认证状态错误，请重新登录"),this.$router.push("/adminLogin"),new Error("Unauthorized");return t},saveSettings(){this.fetchWithAuth("/api/manage/sysConfig/others",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.settings)}).then((()=>this.$message.success("设置已保存")))}},mounted(){this.loading=!0,this.fetchWithAuth("/api/manage/sysConfig/others").then((e=>e.json())).then((e=>{this.settings=e})).finally((()=>{this.loading=!1}))}},C=t(1241);const v=(0,C.A)(k,[["render",p],["__scopeId","data-v-417e6dc2"]]);var y=v;const F={class:"page-settings"},w={class:"first-settings"},_={class:"actions"};function V(e,a,t,o,d,u){const c=n.WK,m=i.xE,h=i.US,b=s.S2,g=l.L;return(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",F,[(0,r.Lk)("div",w,[a[0]||(a[0]=(0,r.Lk)("h3",{class:"first-title"},"页面设置",-1)),(0,r.bF)(h,{model:d.settings,"label-width":"120px"},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(d.settings.config,((e,a)=>((0,r.uX)(),(0,r.Wv)(m,{key:a,label:e.label},{default:(0,r.k6)((()=>[(0,r.bF)(c,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1032,["label"])))),128))])),_:1},8,["model"])]),(0,r.Lk)("div",_,[(0,r.bF)(b,{type:"primary",onClick:u.saveSettings},{default:(0,r.k6)((()=>a[1]||(a[1]=[(0,r.eW)("保存设置")]))),_:1},8,["onClick"])])])),[[g,d.loading]])}var S={data(){return{settings:{config:[]},loading:!1}},computed:{...(0,f.L8)(["credentials"])},methods:{async fetchWithAuth(e,a={}){this.credentials&&(a.headers={...a.headers,Authorization:`Basic ${this.credentials}`},a.credentials="include");const t=await fetch(e,a);if(401===t.status)throw this.$message.error("认证状态错误，请重新登录"),this.$router.push("/adminLogin"),new Error("Unauthorized");return t},saveSettings(){this.fetchWithAuth("/api/manage/sysConfig/page",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.settings)}).then((()=>this.$message.success("设置已保存")))}},mounted(){this.loading=!0,this.fetchWithAuth("/api/manage/sysConfig/page").then((e=>e.json())).then((e=>{this.settings=e})).finally((()=>{this.loading=!1}))}};const x=(0,C.A)(S,[["render",V],["__scopeId","data-v-8bc67b76"]]);var U=x;const A={class:"security-settings"},I={class:"first-settings"},P={class:"first-settings"},L={class:"second-title"},T={class:"first-settings"},W={class:"actions"};function E(e,a,t,u,c,m){const h=n.WK,b=i.xE,g=i.US,p=(0,r.g2)("font-awesome-icon"),f=d.R7,k=o.qi,C=s.S2,v=l.L;return(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",A,[(0,r.Lk)("div",I,[a[9]||(a[9]=(0,r.Lk)("h3",{class:"first-title"},"认证管理",-1)),a[10]||(a[10]=(0,r.Lk)("h4",{class:"second-title"},"用户端认证",-1)),(0,r.bF)(g,{model:c.authSettings.user,rules:c.userPassRules,ref:"userPassForm","label-width":"120px"},{default:(0,r.k6)((()=>[(0,r.bF)(b,{label:"上传密码",prop:"authCode"},{default:(0,r.k6)((()=>[(0,r.bF)(h,{modelValue:c.authSettings.user.authCode,"onUpdate:modelValue":a[0]||(a[0]=e=>c.authSettings.user.authCode=e),type:"password","show-password":"",onInput:m.handleUserPassInput,autocomplete:"new-password"},null,8,["modelValue","onInput"])])),_:1}),c.showUserPassConfirm?((0,r.uX)(),(0,r.Wv)(b,{key:0,label:"确认密码",prop:"confirmNewUserPassword"},{default:(0,r.k6)((()=>[(0,r.bF)(h,{modelValue:c.authSettings.user.confirmNewUserPassword,"onUpdate:modelValue":a[1]||(a[1]=e=>c.authSettings.user.confirmNewUserPassword=e),type:"password","show-password":"",autocomplete:"new-password"},null,8,["modelValue"])])),_:1})):(0,r.Q3)("",!0)])),_:1},8,["model","rules"]),a[11]||(a[11]=(0,r.Lk)("h4",{class:"second-title"},"管理端认证",-1)),(0,r.bF)(g,{model:c.authSettings.admin,rules:c.adminPassRules,ref:"adminPassForm","label-width":"120px"},{default:(0,r.k6)((()=>[(0,r.bF)(b,{label:"用户名",prop:"adminUsername"},{default:(0,r.k6)((()=>[(0,r.bF)(h,{modelValue:c.authSettings.admin.adminUsername,"onUpdate:modelValue":a[2]||(a[2]=e=>c.authSettings.admin.adminUsername=e),autocomplete:"new-password"},null,8,["modelValue"])])),_:1}),(0,r.bF)(b,{label:"密码",prop:"adminPassword"},{default:(0,r.k6)((()=>[(0,r.bF)(h,{modelValue:c.authSettings.admin.adminPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>c.authSettings.admin.adminPassword=e),type:"password","show-password":"",onInput:m.handleAdminPassInput,autocomplete:"new-password"},null,8,["modelValue","onInput"])])),_:1}),c.showAdminPassConfirm?((0,r.uX)(),(0,r.Wv)(b,{key:0,label:"确认密码",prop:"confirmNewAdminPassword"},{default:(0,r.k6)((()=>[(0,r.bF)(h,{modelValue:c.authSettings.admin.confirmNewAdminPassword,"onUpdate:modelValue":a[4]||(a[4]=e=>c.authSettings.admin.confirmNewAdminPassword=e),type:"password","show-password":"",autocomplete:"new-password"},null,8,["modelValue"])])),_:1})):(0,r.Q3)("",!0)])),_:1},8,["model","rules"])]),(0,r.Lk)("div",P,[a[13]||(a[13]=(0,r.Lk)("h3",{class:"first-title"},"上传管理",-1)),(0,r.Lk)("h4",L,[a[12]||(a[12]=(0,r.eW)("图像审查 ")),(0,r.bF)(f,{content:"目前仅支持 moderatecontent.com 渠道",placement:"top"},{default:(0,r.k6)((()=>[(0,r.bF)(p,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})])),_:1})]),(0,r.bF)(g,{model:c.uploadSettings.moderate,"label-width":"120px"},{default:(0,r.k6)((()=>[(0,r.bF)(b,{label:"审查渠道"},{default:(0,r.k6)((()=>[(0,r.bF)(h,{modelValue:c.uploadSettings.moderate.channel,"onUpdate:modelValue":a[5]||(a[5]=e=>c.uploadSettings.moderate.channel=e)},null,8,["modelValue"])])),_:1}),(0,r.bF)(b,{label:"API Key"},{default:(0,r.k6)((()=>[(0,r.bF)(h,{modelValue:c.uploadSettings.moderate.apiKey,"onUpdate:modelValue":a[6]||(a[6]=e=>c.uploadSettings.moderate.apiKey=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])]),(0,r.Lk)("div",T,[a[16]||(a[16]=(0,r.Lk)("h3",{class:"first-title"},"访问管理",-1)),a[17]||(a[17]=(0,r.Lk)("h4",{class:"second-title"},"域名过滤",-1)),(0,r.bF)(g,{model:c.accessSettings,"label-width":"120px"},{default:(0,r.k6)((()=>[(0,r.bF)(b,null,{label:(0,r.k6)((()=>[a[14]||(a[14]=(0,r.eW)(" 放行域名 ")),(0,r.bF)(f,{content:"留空默认全部放行，多个域名请用英文逗号分隔",placement:"top"},{default:(0,r.k6)((()=>[(0,r.bF)(p,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})])),_:1})])),default:(0,r.k6)((()=>[(0,r.bF)(h,{modelValue:c.accessSettings.allowedDomains,"onUpdate:modelValue":a[7]||(a[7]=e=>c.accessSettings.allowedDomains=e)},null,8,["modelValue"])])),_:1}),(0,r.bF)(b,null,{label:(0,r.k6)((()=>[a[15]||(a[15]=(0,r.eW)(" 白名单模式 ")),(0,r.bF)(f,{content:"开启后，仅白名单文件可被访问",placement:"top"},{default:(0,r.k6)((()=>[(0,r.bF)(p,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})])),_:1})])),default:(0,r.k6)((()=>[(0,r.bF)(k,{modelValue:c.accessSettings.whiteListMode,"onUpdate:modelValue":a[8]||(a[8]=e=>c.accessSettings.whiteListMode=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])]),(0,r.Lk)("div",W,[(0,r.bF)(C,{type:"primary",onClick:m.saveSettings},{default:(0,r.k6)((()=>a[18]||(a[18]=[(0,r.eW)("保存设置")]))),_:1},8,["onClick"])])])),[[v,c.loading]])}var $={data(){return{authSettings:{user:{},admin:{}},uploadSettings:{moderate:{}},accessSettings:{},loading:!1,oriUserPassword:"",oriAdminPassword:"",showUserPassConfirm:!1,showAdminPassConfirm:!1,userPassRules:{confirmNewUserPassword:[{message:"请再次输入上传密码",trigger:"blur"},{validator:(e,a,t)=>{a!==this.authSettings.user.authCode?t(new Error("两次输入密码不一致")):t()},trigger:"blur"}]},adminPassRules:{confirmNewAdminPassword:[{message:"请再次输入管理密码",trigger:"blur"},{validator:(e,a,t)=>{a!==this.authSettings.admin.adminPassword?t(new Error("两次输入密码不一致")):t()},trigger:"blur"}]}}},computed:{...(0,f.L8)(["credentials"])},methods:{async fetchWithAuth(e,a={}){this.credentials&&(a.headers={...a.headers,Authorization:`Basic ${this.credentials}`},a.credentials="include");const t=await fetch(e,a);if(401===t.status)throw this.$message.error("认证状态错误，请重新登录"),this.$router.push("/adminLogin"),new Error("Unauthorized");return t},handleUserPassInput(){this.authSettings.user.authCode!==this.oriUserPassword?this.showUserPassConfirm=!0:this.showUserPassConfirm=!1},handleAdminPassInput(){this.authSettings.admin.adminPassword!==this.oriAdminPassword?this.showAdminPassConfirm=!0:this.showAdminPassConfirm=!1},saveSettings(){let e=[];e.push(new Promise((e=>{this.$refs.userPassForm.validate((a=>{e(a)}))}))),e.push(new Promise((e=>{this.$refs.adminPassForm.validate((a=>{e(a)}))}))),Promise.all(e).then((e=>{const a=e.every((e=>e));if(!a)return;const t={auth:this.authSettings,upload:this.uploadSettings,access:this.accessSettings};delete t.auth.user.confirmNewUserPassword,delete t.auth.admin.confirmNewAdminPassword,this.fetchWithAuth("/api/manage/sysConfig/security",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((()=>{this.$message.success("设置已保存")}))}))}},mounted(){this.loading=!0,this.fetchWithAuth("/api/manage/sysConfig/security").then((e=>e.json())).then((e=>{this.authSettings=e.auth,this.uploadSettings=e.upload,this.accessSettings=e.access,this.oriUserPassword=this.authSettings.user.authCode,this.oriAdminPassword=this.authSettings.admin.adminPassword,this.authSettings.user.confirmNewUserPassword="",this.authSettings.admin.confirmNewAdminPassword=""})).finally((()=>{this.loading=!1}))}};const D=(0,C.A)($,[["render",E],["__scopeId","data-v-5e18bcea"]]);var X=D,N=t(6810),K=(t(4396),t(4885),t(4232));const q={class:"upload-settings"},B={class:"upload-channel"},z={class:"channel-settings"},M={class:"second-title"},R={key:0},O={key:1},j={key:2},Q={class:"actions"};function J(e,a,t,u,c,m){const h=N.ll,b=N.MQ,g=(0,r.g2)("font-awesome-icon"),p=d.R7,f=o.qi,k=i.xE,C=i.US,v=n.WK,y=s.S2,F=l.L;return(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",q,[(0,r.Lk)("div",B,[a[3]||(a[3]=(0,r.Lk)("h3",{class:"first-title"},"上传渠道",-1)),(0,r.bF)(b,{modelValue:c.activeChannel,"onUpdate:modelValue":a[0]||(a[0]=e=>c.activeChannel=e)},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c.channels,(e=>((0,r.uX)(),(0,r.Wv)(h,{key:e.value,label:e.value},{default:(0,r.k6)((()=>[(0,r.eW)((0,K.v_)(e.label),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])]),(0,r.Lk)("div",z,[(0,r.Lk)("h4",M,[(0,r.eW)((0,K.v_)(m.activeChannelLabel)+" 设置 ",1),"telegram"===c.activeChannel?((0,r.uX)(),(0,r.Wv)(p,{key:0,content:"为保证兼容性，v2版本前设置的 Telegram 相关环境变量请保留",placement:"right"},{default:(0,r.k6)((()=>[(0,r.bF)(g,{icon:"question-circle",style:{"margin-left":"5px",cursor:"pointer"}})])),_:1})):(0,r.Q3)("",!0)]),"telegram"===c.activeChannel?((0,r.uX)(),(0,r.CE)("div",R,[(0,r.bF)(C,{model:c.telegramSettings,"label-width":"120px",class:"channel-form"},{default:(0,r.k6)((()=>[(0,r.bF)(k,{label:"负载均衡"},{default:(0,r.k6)((()=>[(0,r.bF)(f,{modelValue:c.telegramSettings.loadBalance.enabled,"onUpdate:modelValue":a[1]||(a[1]=e=>c.telegramSettings.loadBalance.enabled=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c.telegramSettings.channels,((e,a)=>((0,r.uX)(),(0,r.Wv)(C,{key:a,model:e,"label-width":"120px",rules:c.tgRules,ref_for:!0,ref:"tgChannelForm",class:"channel-form"},{default:(0,r.k6)((()=>[(0,r.bF)(k,{label:"渠道名",prop:"name"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,r.bF)(k,{label:"启用渠道",prop:"enabled"},{default:(0,r.k6)((()=>[(0,r.bF)(f,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),(0,r.bF)(k,{label:"Bot Token",prop:"botToken"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:e.botToken,"onUpdate:modelValue":a=>e.botToken=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,r.bF)(k,{label:"Chat ID",prop:"chatId"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:e.chatId,"onUpdate:modelValue":a=>e.chatId=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,r.bF)(k,null,{default:(0,r.k6)((()=>[(0,r.bF)(y,{type:"danger",onClick:e=>m.deleteChannel(a),size:"small",disabled:e.fixed},{default:(0,r.k6)((()=>[(0,r.bF)(g,{icon:"trash-alt"})])),_:2},1032,["onClick","disabled"])])),_:2},1024)])),_:2},1032,["model","rules"])))),128))])):(0,r.Q3)("",!0),"cfr2"===c.activeChannel?((0,r.uX)(),(0,r.CE)("div",O,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c.cfr2Settings.channels,((e,a)=>((0,r.uX)(),(0,r.Wv)(C,{model:e,"label-width":"120px",class:"channel-form"},{default:(0,r.k6)((()=>[(0,r.bF)(k,{label:"渠道名"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,r.bF)(k,{label:"启用渠道"},{default:(0,r.k6)((()=>[(0,r.bF)(f,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),(0,r.bF)(k,{label:"公开访问链接"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:e.publicUrl,"onUpdate:modelValue":a=>e.publicUrl=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024)])),_:2},1032,["model"])))),256))])):(0,r.Q3)("",!0),"s3"===c.activeChannel?((0,r.uX)(),(0,r.CE)("div",j,[(0,r.bF)(C,{model:c.s3Settings,"label-width":"120px",class:"channel-form"},{default:(0,r.k6)((()=>[(0,r.bF)(k,{label:"负载均衡"},{default:(0,r.k6)((()=>[(0,r.bF)(f,{modelValue:c.s3Settings.loadBalance.enabled,"onUpdate:modelValue":a[2]||(a[2]=e=>c.s3Settings.loadBalance.enabled=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c.s3Settings.channels,((e,a)=>((0,r.uX)(),(0,r.Wv)(C,{model:e,"label-width":"120px",rules:c.s3Rules,ref_for:!0,ref:"s3ChannelForm",class:"channel-form"},{default:(0,r.k6)((()=>[(0,r.bF)(k,{label:"渠道名",prop:"name"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,r.bF)(k,{label:"启用渠道",prop:"enabled"},{default:(0,r.k6)((()=>[(0,r.bF)(f,{modelValue:e.enabled,"onUpdate:modelValue":a=>e.enabled=a},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),(0,r.bF)(k,{label:"Endpoint",prop:"endpoint"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:e.endpoint,"onUpdate:modelValue":a=>e.endpoint=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,r.bF)(k,{label:"存储桶名称",prop:"bucketName"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:e.bucketName,"onUpdate:modelValue":a=>e.bucketName=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,r.bF)(k,{label:"存储桶区域",prop:"region"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:e.region,"onUpdate:modelValue":a=>e.region=a,placeholder:"auto",disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,r.bF)(k,{label:"访问密钥 ID",prop:"accessKeyId"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:e.accessKeyId,"onUpdate:modelValue":a=>e.accessKeyId=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,r.bF)(k,{label:"机密访问密钥",prop:"secretAccessKey"},{default:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:e.secretAccessKey,"onUpdate:modelValue":a=>e.secretAccessKey=a,disabled:e.fixed},null,8,["modelValue","onUpdate:modelValue","disabled"])])),_:2},1024),(0,r.bF)(k,null,{default:(0,r.k6)((()=>[(0,r.bF)(y,{type:"danger",onClick:e=>m.deleteChannel(a),size:"small",disabled:e.fixed},{default:(0,r.k6)((()=>[(0,r.bF)(g,{icon:"trash-alt"})])),_:2},1032,["onClick","disabled"])])),_:2},1024)])),_:2},1032,["model","rules"])))),256))])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Q,[(0,r.bF)(y,{type:"primary",onClick:m.addChannel},{default:(0,r.k6)((()=>[(0,r.bF)(g,{icon:"plus"})])),_:1},8,["onClick"]),(0,r.bF)(y,{type:"primary",onClick:m.saveSettings},{default:(0,r.k6)((()=>a[4]||(a[4]=[(0,r.eW)("保存设置")]))),_:1},8,["onClick"])])])),[[F,c.loading]])}var Z={data(){return{channels:[{value:"telegram",label:"Telegram"},{value:"cfr2",label:"CloudFlareR2"},{value:"s3",label:"S3"}],activeChannel:"telegram",telegramSettings:{loadBalance:{},channels:[]},tgRules:{name:[{required:!0,message:"请输入渠道名",trigger:"blur"}],botToken:[{required:!0,message:"请输入 Bot Token",trigger:"blur"}],chatId:[{required:!0,message:"请输入 Chat ID",trigger:"blur"}]},cfr2Settings:{channels:[]},s3Settings:{loadBalance:{},channels:[]},s3Rules:{name:[{required:!0,message:"请输入渠道名",trigger:"blur"}],endpoint:[{required:!0,message:"请输入 Endpoint",trigger:"blur"}],bucketName:[{required:!0,message:"请输入存储桶名称",trigger:"blur"}],region:[{required:!0,message:"请输入存储桶区域",trigger:"blur"}],accessKeyId:[{required:!0,message:"请输入访问密钥 ID",trigger:"blur"}],secretAccessKey:[{required:!0,message:"请输入机密访问密钥",trigger:"blur"}]},loading:!1}},computed:{...(0,f.L8)(["credentials"]),activeChannelLabel(){const e=this.channels.find((e=>e.value===this.activeChannel));return e?e.label:""}},methods:{async fetchWithAuth(e,a={}){this.credentials&&(a.headers={...a.headers,Authorization:`Basic ${this.credentials}`},a.credentials="include");const t=await fetch(e,a);if(401===t.status)throw this.$message.error("认证状态错误，请重新登录"),this.$router.push("/adminLogin"),new Error("Unauthorized");return t},addChannel(){switch(this.activeChannel){case"telegram":this.telegramSettings.channels.push({id:this.telegramSettings.channels.length+1,name:"",type:"telegram",savePath:"database",botToken:"",chatId:"",enabled:!0,fixed:!1});break;case"cfr2":this.$message.error("暂不支持增加 R2渠道 配置");break;case"s3":this.s3Settings.channels.push({id:this.s3Settings.channels.length+1,name:"",type:"s3",savePath:"database",accessKeyId:"",secretAccessKey:"",region:"",bucketName:"",endpoint:"",enabled:!0,fixed:!1});break}},deleteChannel(e){switch(this.activeChannel){case"telegram":this.telegramSettings.channels.forEach(((a,t)=>{t>e&&(a.id-=1)})),this.telegramSettings.channels.splice(e,1);break;case"cfr2":this.cfr2Settings.channels.forEach(((a,t)=>{t>e&&(a.id-=1)})),this.cfr2Settings.channels.splice(e,1);break;case"s3":this.s3Settings.channels.forEach(((a,t)=>{t>e&&(a.id-=1)})),this.s3Settings.channels.splice(e,1);break}},saveSettings(){let e=[];this.$refs.tgChannelForm&&this.$refs.tgChannelForm.forEach((a=>{e.push(new Promise((e=>{a.validate((a=>e(a)))})))})),this.$refs.s3ChannelForm&&this.$refs.s3ChannelForm.forEach((a=>{e.push(new Promise((e=>{a.validate((a=>e(a)))})))})),Promise.all(e).then((e=>{const a=e.every((e=>e));if(!a)return;const t={telegram:this.telegramSettings,cfr2:this.cfr2Settings,s3:this.s3Settings};this.fetchWithAuth("/api/manage/sysConfig/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((()=>{this.$message.success("设置已保存")}))}))}},mounted(){this.loading=!0,this.fetchWithAuth("/api/manage/sysConfig/upload").then((e=>e.json())).then((e=>{this.telegramSettings=e.telegram,this.cfr2Settings=e.cfr2,this.s3Settings=e.s3})).finally((()=>{this.loading=!1}))}};const G=(0,C.A)(Z,[["render",J],["__scopeId","data-v-f9d83138"]]);var Y=G,H=t(4182);const ee={class:"sidebar-container"};function ae(e,a,t,l,s,n){const i=(0,r.g2)("font-awesome-icon"),o=H.ct,d=H.lj;return(0,r.uX)(),(0,r.CE)("div",ee,[(0,r.bF)(d,{"default-active":t.activeIndex,class:"el-menu-vertical",collapse:s.isCollapse,onSelect:n.handleSelect},{default:(0,r.k6)((()=>[(0,r.bF)(o,{index:"upload",class:"menu-item"},{default:(0,r.k6)((()=>[(0,r.bF)(i,{icon:"cloud-upload"}),a[1]||(a[1]=(0,r.Lk)("span",{slot:"title"},"上传设置",-1))])),_:1}),(0,r.bF)(o,{index:"security",class:"menu-item"},{default:(0,r.k6)((()=>[(0,r.bF)(i,{icon:"shield"}),a[2]||(a[2]=(0,r.Lk)("span",{slot:"title"},"安全设置",-1))])),_:1}),(0,r.bF)(o,{index:"page",class:"menu-item"},{default:(0,r.k6)((()=>[(0,r.bF)(i,{icon:"pager"}),a[3]||(a[3]=(0,r.Lk)("span",{slot:"title"},"页面设置",-1))])),_:1}),(0,r.bF)(o,{index:"others",class:"menu-item"},{default:(0,r.k6)((()=>[(0,r.bF)(i,{icon:"cog"}),a[4]||(a[4]=(0,r.Lk)("span",{slot:"title"},"其他设置",-1))])),_:1})])),_:1},8,["default-active","collapse","onSelect"]),(0,r.Lk)("div",{class:"toggle-button",onClick:a[0]||(a[0]=(...e)=>n.toggleCollapse&&n.toggleCollapse(...e))},[(0,r.bF)(i,{icon:s.isCollapse?"angle-double-right":"angle-double-left"},null,8,["icon"])])])}var te={name:"SysConfigTabs",props:{activeIndex:{type:String,default:"upload"},isCollapse:{type:Boolean,default:!1}},data(){return{isCollapse:!1}},methods:{toggleCollapse(){this.isCollapse=!this.isCollapse,this.$emit("update:isCollapse",this.isCollapse)},checkMobile(){const e=window.innerWidth<=768;this.isCollapse=e,this.$emit("update:isCollapse",this.isCollapse)},handleSelect(e){this.$emit("update:activeIndex",e)}},mounted(){this.checkMobile(),window.addEventListener("resize",this.checkMobile)},beforeDestroy(){window.removeEventListener("resize",this.checkMobile)}};const le=(0,C.A)(te,[["render",ae],["__scopeId","data-v-1ec6cdc8"]]);var se=le,ne=t(4880),ie=(t(7128),t(3496));const oe={class:"container"},de={class:"header-content"},re={class:"header-action"};function ue(e,a,t,l,s,n){const i=ie.A,o=(0,r.g2)("font-awesome-icon"),u=d.R7,c=ne.bZ,m=se,h=Y,b=X,g=U,p=y;return(0,r.uX)(),(0,r.CE)("div",oe,[(0,r.bF)(c,null,{default:(0,r.k6)((()=>[(0,r.Lk)("div",de,[(0,r.bF)(i,{activeTab:"systemConfig"}),(0,r.Lk)("div",re,[(0,r.bF)(u,{disabled:n.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,r.k6)((()=>[(0,r.bF)(o,{icon:"sign-out-alt",class:"header-icon",onClick:n.handleLogout},null,8,["onClick"])])),_:1},8,["disabled"])])])])),_:1}),(0,r.bF)(m,{activeIndex:s.activeIndex,"onUpdate:activeIndex":a[0]||(a[0]=e=>s.activeIndex=e),isCollapse:s.isSidebarCollapse,"onUpdate:isCollapse":a[1]||(a[1]=e=>s.isSidebarCollapse=e)},null,8,["activeIndex","isCollapse"]),"upload"===s.activeIndex?((0,r.uX)(),(0,r.Wv)(h,{key:0,class:(0,K.C4)(["main-container",{collapsed:s.isSidebarCollapse}])},null,8,["class"])):"security"===s.activeIndex?((0,r.uX)(),(0,r.Wv)(b,{key:1,class:(0,K.C4)(["main-container",{collapsed:s.isSidebarCollapse}])},null,8,["class"])):"page"===s.activeIndex?((0,r.uX)(),(0,r.Wv)(g,{key:2,class:(0,K.C4)(["main-container",{collapsed:s.isSidebarCollapse}])},null,8,["class"])):((0,r.uX)(),(0,r.Wv)(p,{key:3,class:(0,K.C4)(["main-container",{collapsed:s.isSidebarCollapse}])},null,8,["class"]))])}var ce={name:"SystemConfig",data(){return{activeIndex:"upload",isSidebarCollapse:!1}},watch:{},components:{DashboardTabs:ie.A,SysConfigTabs:se,SysCogUpload:Y,SysCogSecurity:X,SysCogPage:U,SysCogOthers:y},computed:{...(0,f.L8)(["credentials"]),disableTooltip(){return window.innerWidth<768}},methods:{async fetchWithAuth(e,a={}){this.credentials&&(a.headers={...a.headers,Authorization:`Basic ${this.credentials}`},a.credentials="include");const t=await fetch(e,a);if(401===t.status)throw this.$message.error("认证状态错误，请重新登录"),this.$router.push("/adminLogin"),new Error("Unauthorized");return t},handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")}}};const me=(0,C.A)(ce,[["render",ue],["__scopeId","data-v-7fa691ea"]]);var he=me},8050:function(e,a,t){t(5331)},3597:function(e,a,t){t(5331)},8830:function(e,a,t){t(5331)},6055:function(e,a,t){t(5331),t(9648),t(8050),t(9104),t(5970)},3003:function(e,a,t){t(5331)},8642:function(e,a,t){t(5331)},7128:function(e,a,t){t(5331),t(4318)},694:function(e,a,t){t(5331)},9104:function(e,a,t){t(5331)},4396:function(e,a,t){t(5331)},4885:function(e,a,t){t(5331)},5970:function(e,a,t){t(5331)},456:function(e,a,t){t(5331)},213:function(e,a,t){t(5331),t(9104)}}]);
//# sourceMappingURL=136.f3c475a0.js.map