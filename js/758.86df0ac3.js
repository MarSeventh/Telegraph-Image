"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[758],{7758:function(e,t,a){a.r(t),a.d(t,{default:function(){return S}});var n=a(4880),s=(a(5331),a(7815)),o=(a(5970),a(9104),a(683)),l=(a(5385),a(47)),i=(a(9648),a(7009)),c=a(850),d=a(1450),r=(a(213),a(9017)),h=(a(8050),a(2105)),u=(a(9092),a(6768)),m=a(4232),p=a(5130);const b={class:"header-content"},g={class:"search-card"},f={class:"stats"},k={class:"actions"},C={class:"el-dropdown-link"},F={class:"content"},v=["src"],D={class:"image-overlay"},y={class:"overlay-buttons"},T={class:"file-info"},$={class:"pagination-container"};function _(e,t,a,_,w,L){const x=h.WK,S=(0,u.g2)("font-awesome-icon"),I=r.c6,z=r.Iy,B=r.dW,W=d.R7,E=n.bZ,O=c.dI,P=i.Zq,G=l.S2,V=o.Ik,X=s.aQ,A=n.ZO,N=n.lX;return(0,u.uX)(),(0,u.Wv)(N,{class:"container"},{default:(0,u.k6)((()=>[(0,u.bF)(E,null,{default:(0,u.k6)((()=>[(0,u.Lk)("div",b,[(0,u.Lk)("span",{class:"title",onClick:t[0]||(t[0]=(...e)=>L.refreshDashboard&&L.refreshDashboard(...e))},"Dashboard"),(0,u.Lk)("div",g,[(0,u.bF)(x,{modelValue:w.search,"onUpdate:modelValue":t[1]||(t[1]=e=>w.search=e),size:"mini",placeholder:"输入关键字搜索"},null,8,["modelValue"])]),(0,u.Lk)("span",f,[(0,u.bF)(S,{icon:"database",class:"fa-database"}),(0,u.eW)(" 记录总数量: "+(0,m.v_)(w.Number),1)]),(0,u.Lk)("div",k,[(0,u.bF)(W,{content:"排序",placement:"bottom"},{default:(0,u.k6)((()=>[(0,u.bF)(B,{onCommand:L.sort,"hide-on-click":!1},{dropdown:(0,u.k6)((()=>[(0,u.bF)(z,null,{default:(0,u.k6)((()=>[(0,u.bF)(I,{command:"dateDesc"},{default:(0,u.k6)((()=>t[2]||(t[2]=[(0,u.eW)("按时间倒序")]))),_:1}),(0,u.bF)(I,{command:"nameAsc"},{default:(0,u.k6)((()=>t[3]||(t[3]=[(0,u.eW)("按名称升序")]))),_:1})])),_:1})])),default:(0,u.k6)((()=>[(0,u.Lk)("span",C,[(0,u.bF)(S,{icon:L.sortIcon,class:"header-icon"},null,8,["icon"])])])),_:1},8,["onCommand"])])),_:1}),(0,u.bF)(W,{content:"批量复制",placement:"bottom"},{default:(0,u.k6)((()=>[(0,u.bF)(S,{icon:"link",class:(0,m.C4)(["header-icon",{disabled:0===w.selectedFiles.length}]),onClick:L.handleBatchCopy},null,8,["class","onClick"])])),_:1}),(0,u.bF)(W,{content:"批量删除",placement:"bottom"},{default:(0,u.k6)((()=>[(0,u.bF)(S,{icon:"trash-alt",class:(0,m.C4)(["header-icon",{disabled:0===w.selectedFiles.length}]),onClick:L.handleBatchDelete},null,8,["class","onClick"])])),_:1}),(0,u.bF)(W,{content:"黑白名单管理",placement:"bottom"},{default:(0,u.k6)((()=>[(0,u.bF)(S,{icon:"user-cog",class:"header-icon",onClick:L.handleGoToAdmin},null,8,["onClick"])])),_:1}),(0,u.bF)(W,{content:"返回上传页",placement:"bottom"},{default:(0,u.k6)((()=>[(0,u.bF)(S,{icon:"home",class:"header-icon",onClick:L.handleLogout},null,8,["onClick"])])),_:1})])])])),_:1}),(0,u.bF)(A,{class:"main-container"},{default:(0,u.k6)((()=>[(0,u.Lk)("div",F,[((0,u.uX)(!0),(0,u.CE)(u.FK,null,(0,u.pI)(L.paginatedTableData,((e,a)=>((0,u.uX)(),(0,u.Wv)(V,{key:a},{default:(0,u.k6)((()=>[(0,u.bF)(O,{modelValue:e.selected,"onUpdate:modelValue":t=>e.selected=t},null,8,["modelValue","onUpdate:modelValue"]),e.metadata?.FileType?.includes("video")?((0,u.uX)(),(0,u.CE)("video",{key:0,src:"/file/"+e.name,autoplay:"",muted:"",loop:"",class:"video-preview"},null,8,v)):((0,u.uX)(),(0,u.Wv)(P,{key:1,src:"/file/"+e.name,"preview-src-list":["/file/"+e.name],fit:"cover",lazy:""},null,8,["src","preview-src-list"])),(0,u.Lk)("div",D,[(0,u.Lk)("div",y,[(0,u.bF)(G,{size:"mini",type:"primary",onClick:(0,p.D$)((t=>L.handleCopy(a,e.name)),["stop"])},{default:(0,u.k6)((()=>t[4]||(t[4]=[(0,u.eW)("复制地址")]))),_:2},1032,["onClick"]),(0,u.bF)(G,{size:"mini",type:"danger",onClick:(0,p.D$)((t=>L.handleDelete(a,e.name)),["stop"])},{default:(0,u.k6)((()=>t[5]||(t[5]=[(0,u.eW)("删除")]))),_:2},1032,["onClick"])])]),(0,u.Lk)("div",T,(0,m.v_)(e.metadata?.FileName||e.name),1)])),_:2},1024)))),128))]),(0,u.Lk)("div",$,[(0,u.bF)(X,{background:"",layout:"prev, pager, next",total:L.filteredTableData.length,"page-size":w.pageSize,onCurrentChange:L.handlePageChange,"current-page":w.currentPage},null,8,["total","page-size","onCurrentChange","current-page"])])])),_:1})])),_:1})}a(4114);var w={data(){return{Number:0,showLogoutButton:!1,tableData:[],search:"",currentPage:1,pageSize:15,selectedFiles:[],sortOption:"dateDesc",isUploading:!1}},computed:{filteredTableData(){return this.tableData.filter((e=>!this.search||e.name.toLowerCase().includes(this.search.toLowerCase())))},paginatedTableData(){const e=this.sortData(this.filteredTableData),t=(this.currentPage-1)*this.pageSize,a=t+this.pageSize;return e.slice(t,a)},sortIcon(){return"dateDesc"===this.sortOption?"sort-amount-down":"sort-alpha-up"}},watch:{tableData:{handler(e){this.selectedFiles=e.filter((e=>e.selected))},deep:!0},sortOption(e){localStorage.setItem("sortOption",e)}},methods:{refreshDashboard(){location.reload()},handleDelete(e,t){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{fetch(`./api/manage/delete/${t}`,{method:"GET",credentials:"include"}).then((e=>{if(!e.ok)return Promise.reject("请求失败");{const e=this.tableData.findIndex((e=>e.name===t));-1!==e&&this.tableData.splice(e,1)}})).then((()=>{this.updateStats(),this.$message.success("删除成功!")})).catch((()=>this.$message.error("删除失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消删除")))},handleBatchDelete(){this.$confirm("此操作将永久删除选中的文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=this.selectedFiles.map((e=>fetch(`./api/manage/delete/${e.name}`,{method:"GET",credentials:"include"})));Promise.all(e).then((e=>{e.forEach(((e,t)=>{if(e.ok){const e=this.tableData.findIndex((e=>e.name===this.selectedFiles[t].name));-1!==e&&this.tableData.splice(e,1)}})),this.selectedFiles=[],this.updateStats(),this.$message.success("批量删除成功!")})).catch((()=>this.$message.error("批量删除失败，请检查网络连接")))})).catch((()=>this.$message.info("已取消批量删除")))},handleBatchCopy(){const e=this.selectedFiles.map((e=>`${document.location.origin}/file/${e.name}`)).join("\n");navigator.clipboard?navigator.clipboard.writeText(e).then((()=>this.$message.success("批量复制链接成功~"))):this.copyToClipboardFallback(e)},copyToClipboardFallback(e){const t=document.createElement("textarea");document.body.appendChild(t),t.style.position="fixed",t.style.clip="rect(0 0 0 0)",t.style.top="10px",t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t),this.$message.success("批量复制链接成功~")},handleLogout(){this.$router.push("/")},handleGoToAdmin(){window.location.href="/admin-detail"},handleCopy(e,t){const a=`${document.location.origin}/file/${t}`;navigator.clipboard?navigator.clipboard.writeText(a).then((()=>this.$message.success("复制文件链接成功~"))):this.copyToClipboardFallback(a)},handlePageChange(e){this.currentPage=e},updateStats(){this.Number=this.tableData.length},sort(e){this.sortOption=e},sortData(e){return"nameAsc"===this.sortOption?e.sort(((e,t)=>e.name.localeCompare(t.name))):e.sort(((e,t)=>t.metadata.TimeStamp-e.metadata.TimeStamp))}},mounted(){fetch("./api/manage/check",{method:"GET",credentials:"include"}).then((e=>e.text())).then((e=>"true"==e?(this.showLogoutButton=!0,fetch("./api/manage/list",{method:"GET",credentials:"include"})):"Not using basic auth."==e?fetch("./api/manage/list",{method:"GET",credentials:"include"}):Promise.reject())).then((e=>e.json())).then((e=>{this.tableData=e.map((e=>({...e,selected:!1}))),this.updateStats();const t=localStorage.getItem("sortOption");t&&(this.sortOption=t),this.sortData(this.tableData)})).catch((()=>this.$message.error("同步数据时出错，请检查网络连接")))}},L=a(1241);const x=(0,L.A)(w,[["render",_],["__scopeId","data-v-92bda5d4"]]);var S=x},8050:function(e,t,a){a(5331)},5385:function(e,t,a){a(5331)},9104:function(e,t,a){a(5331)},5970:function(e,t,a){a(5331)},213:function(e,t,a){a(5331),a(9104)}}]);
//# sourceMappingURL=758.86df0ac3.js.map