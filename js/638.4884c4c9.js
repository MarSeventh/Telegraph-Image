"use strict";(self["webpackChunksanyue_imghub"]=self["webpackChunksanyue_imghub"]||[]).push([[638],{4318:function(){},772:function(t,e,a){a.d(e,{A:function(){return u}});var i=a(9017),o=(a(5331),a(6055),a(8830),a(3597),a(6768)),n=a(4232);const s={class:"tabs"},r={class:"tabs-dropdown-link"};function l(t,e,a,l,d,c){const h=(0,o.g2)("font-awesome-icon"),u=i.c6,m=i.Iy,p=i.dW;return(0,o.uX)(),(0,o.CE)("div",s,[(0,o.Lk)("span",{class:"title",onClick:e[0]||(e[0]=(...t)=>c.refreshDashboard&&c.refreshDashboard(...t))},[(0,o.bF)(h,{icon:c.iconName,class:"fa-images"},null,8,["icon"]),(0,o.eW)(" "+(0,n.v_)(c.titleName),1)]),(0,o.bF)(p,{onCommand:c.handleTabClick,class:"tabs-dropdown",role:"navigation",onVisibleChange:c.handleDropdownVisible,"popper-class":"tabs-dropdown-popper"},{dropdown:(0,o.k6)((()=>[(0,o.bF)(m,null,{default:(0,o.k6)((()=>["dashboard"!==a.activeTab?((0,o.uX)(),(0,o.Wv)(u,{key:0,command:"dashboard"},{default:(0,o.k6)((()=>[(0,o.bF)(h,{icon:"images",style:{"margin-right":"5px"}}),e[1]||(e[1]=(0,o.eW)(" Gallery "))])),_:1})):(0,o.Q3)("",!0),"customerConfig"!==a.activeTab?((0,o.uX)(),(0,o.Wv)(u,{key:1,command:"customerConfig"},{default:(0,o.k6)((()=>[(0,o.bF)(h,{icon:"user-cog",style:{"margin-right":"5px"}}),e[2]||(e[2]=(0,o.eW)(" 用户管理 "))])),_:1})):(0,o.Q3)("",!0),"systemConfig"!==a.activeTab?((0,o.uX)(),(0,o.Wv)(u,{key:2,command:"systemConfig"},{default:(0,o.k6)((()=>[(0,o.bF)(h,{icon:"cogs",style:{"margin-right":"5px"}}),e[3]||(e[3]=(0,o.eW)(" 系统设置 "))])),_:1})):(0,o.Q3)("",!0),(0,o.bF)(u,{command:""},{default:(0,o.k6)((()=>[(0,o.bF)(h,{icon:"upload",style:{"margin-right":"5px"}}),e[4]||(e[4]=(0,o.eW)(" 上传页面 "))])),_:1})])),_:1})])),default:(0,o.k6)((()=>[(0,o.Lk)("span",r,[(0,o.bF)(h,{icon:"sort-down",class:"tabs-arrow"})])])),_:1},8,["onCommand","onVisibleChange"])])}a(4114);var d={name:"DashboardTabs",props:{activeTab:{type:String,default:"dashboard"}},computed:{titleName(){return"dashboard"===this.activeTab?"Gallery":"customerConfig"===this.activeTab?"用户管理":"systemConfig"===this.activeTab?"系统设置":"上传页面"},iconName(){return"dashboard"===this.activeTab?"images":"customerConfig"===this.activeTab?"user-cog":"systemConfig"===this.activeTab?"cogs":"upload"}},methods:{refreshDashboard(){location.reload()},handleTabClick(t){this.$router.push(`/${t}`)},handleDropdownVisible(t){const e=document.querySelector(".tabs-dropdown-link");t?e.classList.add("rotate-up"):e.classList.remove("rotate-up")}}},c=a(1241);const h=(0,c.A)(d,[["render",l],["__scopeId","data-v-7182a131"]]);var u=h},7638:function(t,e,a){a.r(e),a.d(e,{default:function(){return T}});var i=a(5558),o=(a(5331),a(456),a(6023)),n=(a(8736),a(213),a(5970),a(7009)),s=(a(8450),a(8785),a(4880)),r=(a(7128),a(1450)),l=a(772),d=a(6768),c=a(4232);const h={class:"container"},u={class:"header-content"},m={class:"header-action"},p={class:"main-container"},b={style:{margin:"8px"}},f=["src"];function g(t,e,a,g,k,v){const w=l.A,y=(0,d.g2)("font-awesome-icon"),T=r.R7,C=s.bZ,F=o.o8,L=n.Zq,_=o.Up,W=i.qi;return(0,d.uX)(),(0,d.CE)("div",h,[(0,d.bF)(C,null,{default:(0,d.k6)((()=>[(0,d.Lk)("div",u,[(0,d.bF)(w,{activeTab:"customerConfig"}),(0,d.Lk)("div",m,[(0,d.bF)(T,{disabled:v.disableTooltip,content:"退出登录",placement:"bottom"},{default:(0,d.k6)((()=>[(0,d.bF)(y,{icon:"sign-out-alt",class:"header-icon",onClick:v.handleLogout},null,8,["onClick"])])),_:1},8,["disabled"])])])])),_:1}),(0,d.Lk)("div",p,[(0,d.bF)(_,{data:k.dealedData,"default-sort":{prop:"count",order:"descending"},class:"main-table","table-layout":"fixed"},{default:(0,d.k6)((()=>[(0,d.bF)(F,{type:"expand"},{default:(0,d.k6)((t=>[(0,d.Lk)("div",b,[e[0]||(e[0]=(0,d.Lk)("h3",{style:{"text-align":"center"}},"上传文件列表",-1)),(0,d.bF)(_,{data:t.row.data,style:{width:"100%"},"default-sort":{prop:"metadata.TimeStamp",order:"descending"},"table-layout":"fixed"},{default:(0,d.k6)((()=>[(0,d.bF)(F,{prop:"metadata.FileName",label:"文件名"}),(0,d.bF)(F,{prop:"name",label:"文件预览"},{default:(0,d.k6)((({row:t})=>[t.metadata?.FileType?.includes("image")?((0,d.uX)(),(0,d.Wv)(L,{key:0,src:"/file/"+t.name+"?from=admin",fit:"cover",lazy:"",style:{width:"100px",height:"100px"}},null,8,["src"])):((0,d.uX)(),(0,d.CE)("video",{key:1,src:"/file/"+t.name+"?from=admin",controls:"",style:{width:"100px",height:"100px"}},null,8,f))])),_:1}),(0,d.bF)(F,{formatter:v.formatTimeStamp,label:"上传时间",prop:"metadata.TimeStamp",sortable:"","sort-method":v.sortByTimestamp},{default:(0,d.k6)((({row:t})=>[(0,d.eW)((0,c.v_)(v.formatTimeStamp(t.metadata.TimeStamp)),1)])),_:1},8,["formatter","sort-method"])])),_:2},1032,["data"])])])),_:1}),(0,d.bF)(F,{prop:"ip",label:"IP地址"}),(0,d.bF)(F,{prop:"count",label:"上传次数",sortable:""}),(0,d.bF)(F,{label:"允许上传"},{default:(0,d.k6)((({row:t})=>[(0,d.bF)(W,{modelValue:t.enable,"onUpdate:modelValue":e=>t.enable=e,"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"允许","inactive-text":"禁止",onChange:e=>v.handleSwitchEnable(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1})])),_:1},8,["data"])])])}a(4114),a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698);var k=a(782),v={name:"CustomerConfig",data(){return{tableData:[],dealedData:[],blockipList:[]}},components:{DashboardTabs:l.A},computed:{...(0,k.L8)(["credentials"]),disableTooltip(){return window.innerWidth<768}},methods:{async fetchWithAuth(t,e={}){this.credentials&&(e.headers={...e.headers,Authorization:`Basic ${this.credentials}`},e.credentials="include");const a=await fetch(t,e);if(401===a.status)throw this.$message.error("认证状态错误，请重新登录"),this.$router.push("/adminLogin"),new Error("Unauthorized");return a},dealByIP(t){let e=[],a=new Set;return t.forEach((t=>{t.metadata?.UploadIP&&a.add(t.metadata.UploadIP)})),a.forEach((a=>{let i=t.filter((t=>t.metadata?.UploadIP===a)),o=i.length,n=!this.blockipList.includes(a);e.push({ip:a,count:o,data:i,enable:n})})),e},handleLogout(){this.$store.commit("setCredentials",null),this.$router.push("/adminLogin")},formatTimeStamp(t){return new Date(t).toLocaleString()},sortByTimestamp(t,e){return new Date(t.metadata.TimeStamp)-new Date(e.metadata.TimeStamp)},async handleSwitchEnable(t){const e=t.ip,a=t.enable;a?(this.blockipList=this.blockipList.filter((t=>t!==e)),await this.fetchWithAuth("/api/manage/cusConfig/whiteip",{method:"POST",body:e})):(this.blockipList.push(e),await this.fetchWithAuth("/api/manage/cusConfig/blockip",{method:"POST",body:e}))}},mounted(){this.fetchWithAuth("/api/manage/check",{method:"GET"}).then((t=>t.text())).then((t=>{if("true"==t)return this.showLogoutButton=!0,this.fetchWithAuth("/api/manage/list",{method:"GET"});if("Not using basic auth."==t)return this.fetchWithAuth("/api/manage/list",{method:"GET"});throw new Error("Unauthorized")})).then((t=>t.json())).then((async t=>{const e=await this.fetchWithAuth("/api/manage/cusConfig/blockipList",{method:"GET"});this.blockipList=(await e.text()).split(","),this.tableData=t,this.dealedData=this.dealByIP(t)})).catch((t=>{"Unauthorized"!==t.message&&this.$message.error("同步数据时出错，请检查网络连接")}))}},w=a(1241);const y=(0,w.A)(v,[["render",g],["__scopeId","data-v-f33818fc"]]);var T=y},8050:function(t,e,a){a(5331)},8736:function(t,e,a){a(5331)},3597:function(t,e,a){a(5331)},8830:function(t,e,a){a(5331)},6055:function(t,e,a){a(5331),a(9648),a(8050),a(9104),a(5970)},7128:function(t,e,a){a(5331),a(4318)},8450:function(t,e,a){a(5331)},9104:function(t,e,a){a(5331)},5970:function(t,e,a){a(5331)},456:function(t,e,a){a(5331)},8785:function(t,e,a){a(5331)},213:function(t,e,a){a(5331),a(9104)}}]);
//# sourceMappingURL=638.4884c4c9.js.map